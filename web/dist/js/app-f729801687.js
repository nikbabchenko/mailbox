"use strict";function LoginPageController(t,e){var a=this;e.getToken()&&(a.user="user")}LoginPageController.$inject=["$rootScope","AuthTokenFactory"],angular.module("mailBox",["ui.router","mailBox.mailPage","mailBox.login","mailBox.addContact"]),angular.module("mailBox.addContact",[]),angular.module("mailBox.mailPage",[]),function(){angular.module("mailBox").constant("API_URL","http://localhost:3000")}(),angular.module("mailBox").config(["$stateProvider","$httpProvider",function(t,e){t.state("help",{url:"/help",template:"<help></help>"}).state("mail",{url:"/inbox/:id",template:"<mail></mail>"}).state("contacts",{url:"/contacts",template:"<contacts-list></contacts-list>"}).state("user",{url:"/user/:id",template:"<contact><contact>"}).state("home",{url:"",template:"<homepage><homepage>"}),e.interceptors.push("AuthInterCepter")}]),function(){function t(t,e,a){function n(){a.setToken(),i()}function i(){t.reload(),l.user=!1}var l=this;l.user=!0,e.$on("$stateChangeStart",function(e,n){a.getToken()&&(l.user=!0),-1===n.name.indexOf("login")&&(a.getToken()||(e.preventDefault(),t.go("login")))}),e.$on("signed-in",function(){l.user=!0}),e.$on("signed-out",function(){l.user=!1}),l.logout=n}t.$inject=["$state","$rootScope","AuthTokenFactory"],angular.module("mailBox").controller("CommonController",t)}(),angular.module("mailBox").directive("contact",["UserService","$state","$timeout",function(t,e,a){function n(n){function i(t){n.user=t.data}function l(){a(function(){n.showControls=!0},300)}console.log(e);var o=e.params.id;n.showControls=!1,t.getUserById(o).then(i).then(l)}return{replace:!0,restrict:"E",scope:"true",templateUrl:"components/contact/contact.html",link:n}}]),angular.module("mailBox").directive("contactsList",["$state","UserService",function(t,e){function a(a){function n(t){a.users=t.data}function i(e){t.go("user",{id:e})}function l(){a.showControls=!0}a.title="Contacts - the main part of app",a.showUser=i,a.showControls=!1,e.getUsers().then(n).then(l)}return{replace:!0,restrict:"E",scope:{},templateUrl:"components/contactsList/contactsList.html",link:a}}]),function(){angular.module("mailBox").directive("help",function(){function t(t){t.title="FAQ"}return{restrict:"E",replace:!0,scope:!0,templateUrl:"components/help/help.html",link:t}})}(),angular.module("mailBox").directive("homepage",function(){function t(t){t.title="Hello Mail",t.subtitle="Homepage"}return{restrict:"E",replace:!0,scope:!0,templateUrl:"components/homepage/homepage.html",link:t}}),angular.module("mailBox").directive("login",["$state","$rootScope","UserFactory","AuthTokenFactory",function(t,e,a,n){function i(i){function l(t,l){function o(t){console.log(t.data)}return t&&l&&(t||l)?void a.login(t,l).then(function(t){return console.log(t.data.user),i.user=t.data.user,t},o).then(function(t){return n.setToken(t.data.token),s(),e.$broadcast("signed-in"),t}):void alert("You should enter login and password")}function o(){n.setToken(),i.user=null,e.$broadcast("signed-out")}function s(){t.go("home")}i.login=l,i.logout=o}return{restrict:"E",replace:!0,templateUrl:"components/login/login.html",scope:{user:"="},link:i}}]),angular.module("mailBox").directive("mail",["MailService","$state",function(t,e){function a(a){function n(t){var e=a.mails.map(function(t){return t.id}).indexOf(parseInt(t));o=a.mails[e]}function i(){a.isEdit=!0}function l(){c.setItem("mail"+a.mail.id,JSON.stringify(a.mail)),console.log(a.mail),a.isEdit=!1}var o,s,r=e.params.id,c=localStorage,u="mail"+r;a.isEdit=!1,a.editMail=i,a.saveMail=l,c.getItem(u)?function(t){s=c.getItem(t),a.mail=JSON.parse(s)}(u):function(){t.getAll().then(function(t){a.mails=t.data,n(r),a.mail=o,console.log(o)})}()}return{replace:!0,restrict:"E",scope:"true",templateUrl:"components/mail/mail.html",link:a}}]),angular.module("mailBox").directive("mailList",["$state","MailService",function(t,e){function a(a){function n(e){t.go("mail",{id:e.id})}var i=t.current.name;i=i[0].toUpperCase()+i.slice(1),a.title=i,a.showFullMail=n,e.getAll().then(function(t){a.mails=t.data})}return{replace:!0,restrict:"E",scope:"true",templateUrl:"components/maillist/maillist.html",link:a}}]),angular.module("mailBox").directive("menu",function(){return{restrict:"E",replace:!0,scope:!0,templateUrl:"components/menu/menu.html"}}),angular.module("mailBox").directive("navbar",["UserService",function(t){function e(e){function a(t){e.users=t.data}t.getUsers().then(a)}return{restrict:"E",replace:!0,scope:!0,templateUrl:"components/navbar/navbar.html",link:e}}]),angular.module("mailBox").directive("search",function(){function t(t){function e(){t.searchString=""}t.clearInput=e}return{restrict:"E",replace:!0,scope:{arr:"="},templateUrl:"components/search/search.html",link:t}}),function(){function t(t){function e(e){var a=t.getToken();return a&&(e.headers=e.headers||{},e.headers.Authorization="Bearer "+a),e}return{request:e}}t.$inject=["AuthTokenFactory"],angular.module("mailBox").factory("AuthInterCepter",t)}(),function(){function t(t){function e(){return n.getItem(i)}function a(t){t?n.setItem(i,t):n.removeItem(i)}var n=t.localStorage,i="auth-token";return{getToken:e,setToken:a}}t.$inject=["$window"],angular.module("mailBox").factory("AuthTokenFactory",t)}(),function(){function t(){return function(t,e){if(!e)return!1;var a=[];return e=e.toLowerCase(),angular.forEach(t,function(t){-1!==t.name.toLowerCase().indexOf(e)&&a.push(t)}),a}}angular.module("mailBox").filter("mailBoxSearch",t)}(),function(){function t(t){this.getAll=function(){return t.get("mails.json")},this.getItem=function(e){return t.get("mails.json + '/'"+e)}}t.$inject=["$http"],angular.module("mailBox").service("MailService",t)}(),function(){function t(t,e){function a(a,n){return t.post(e+"/login",{username:a,password:n})}return{login:a}}t.$inject=["$http","API_URL"],angular.module("mailBox").factory("UserFactory",t)}(),function(){function t(t,e){function a(){return t.get(s,{withCredentials:!0,cache:!0})}function n(e){return t.get(s+"/"+e,{withCredentials:!0,cache:!0})}function i(t,e,a,n,i){function s(t,e,a,n,i,l){o={name:t,company:e,email:a,phone:n,site:i,id:l.length+1},l.push(o),l=JSON.stringify(l,null,"\t"),r.setItem("contacts",l)}r.getItem("contacts")?(l=r.getItem("contacts"),l=JSON.parse(l),s.apply(null,[t,e,a,n,i,l])):(l=[],s.apply(null,[t,e,a,n,i,l]))}var l,o,s="http://jsonplaceholder.typicode.com/users",r=e.localStorage;this.getUsers=a,this.getUserById=n,this.addContact=i}t.$inject=["$http","$window"],angular.module("mailBox").service("UserService",t)}(),function(){function t(t){t.state("addContact",{url:"/add-contact",templateUrl:"pages/add-contact/add-contact.html"})}t.$inject=["$stateProvider"],angular.module("mailBox.addContact").config(t)}(),function(){function t(t,e){function a(){t.history.back()}function n(t,a,n,i,l){console.log(t,a,n,i,l),e.addContact(t,a,n,i,l)}var i=this;i.goBack=a,i.addContact=n}t.$inject=["$window","UserService"],angular.module("mailBox.addContact").controller("AddContactPageController",t)}(),angular.module("mailBox.login",[]),function(){function t(t){t.state("login",{url:"/login",templateUrl:"pages/login/login.html",controller:"LoginPageController"})}t.$inject=["$stateProvider"],angular.module("mailBox.login").config(t)}(),angular.module("mailBox.login").controller("LoginPageController",LoginPageController),function(){function t(t){t.state("inbox",{url:"/inbox",templateUrl:"pages/mail-page/mail-page.html",controller:"MailPageController"}).state("drafts",{url:"/drafts",templateUrl:"pages/mail-page/mail-page.html",controller:"MailPageController"}).state("sent",{url:"/sent",templateUrl:"pages/mail-page/mail-page.html",controller:"MailPageController"})}t.$inject=["$stateProvider"],angular.module("mailBox.mailPage").config(t)}(),function(){function t(){console.log("test")}angular.module("mailBox.mailPage").controller("MailPageController",t)}(),angular.module("mailBox").run(["$templateCache",function(t){t.put("components/contact/contact.html",'<div class="contact col-md-6"><div class="contact-photo"><img src="https://placeimg.com/400/250/people" alt="" class="image-responsive"></div><h3 class="contact-title" ng-hide="isEdit"><span>Username:</span> {{ user.name }}</h3><input type="text" ng-show="isEdit" ng-model="contact.title" class="form-control"><div class="content" ng-hide="isEdit"><div class="content-item"><span>Company:</span> {{ user.company.name }}</div><div class="content-item"><span>Phone</span>: {{ user.phone }}</div><div class="content-item"><span>Website</span>: {{ user.website }}</div><div class="content-item"><span>Adress</span>: {{ user.address.city }} , {{ user.address.street }}</div></div><div class="contact-edit" ng-show="isEdit"><textarea type="text" ng-model="contact.content"></textarea></div><div class="contact-controls" ng-show="showControls"><button class="btn btn-warning" ng-click="editMail()" ng-hide="isEdit"><span class="glyphicon glyphicon-pencil"></span> Edit</button> <button class="btn btn-primary" ng-click="saveMail()" ng-hide="!isEdit"><span class="glyphicon glyphicon-save"></span> Save</button><buttom class="btn btn-danger" ng-click="deleteMail()"><span class="glyphicon glyphicon-trash"></span> Delete</buttom></div></div>'),t.put("components/contactsList/contactsList.html",'<div class="contacts-list"><h1 class="page-header">{{ title }}</h1><div class="table-responsive"><table class="table table-striped"><thead><tr><th>User</th><th>Email</th><th>Phone</th><th>Website</th></tr></thead><tbody><tr ng-repeat="item in users track by $index" class="inbox-item" ng-click="showUser(item.id)"><td>{{ item.name }}</td><td>{{ item.email }}</td><td>{{ item.phone }}</td><td>{{ item.website }}</td></tr></tbody></table></div><div class="control-bar" ng-show="showControls"><button class="btn btn-danger" ui-sref="addContact">Add contact</button></div></div>'),t.put("components/help/help.html",'<div class="help-page"><h1 class="page-header">{{ title }}</h1><div class="panel panel-default"><div class="panel-heading">Help</div><div class="panel-body"><p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Molestias harum possimus aperiam, rerum nisi unde eum, amet vitae laudantium, minus tempore aliquid!</p></div><ul class="list-group"><li class="list-group-item">Cras justo odio</li><li class="list-group-item">Dapibus ac facilisis in</li><li class="list-group-item">Morbi leo risus</li><li class="list-group-item">Porta ac consectetur ac</li><li class="list-group-item">Vestibulum at eros</li></ul></div></div>'),t.put("components/homepage/homepage.html",'<div class="homepage"><div class="jumbotron"><h1>This is a mailbox</h1><p><a class="btn btn-primary btn-lg" role="button" ui-sref="inbox">Go To Inbox</a></p></div></div>'),t.put("components/login/login.html",'<div class="sign-in"><form ng-submit="login(username, password)" ng-if="!user"><h2 class="form-signin-heading">Please sign in</h2><div class="sign-in__item"><label class="sr-only" for="inputEmail">Email address</label><input type="text" id="inputEmail" class="form-control" placeholder="Email address" ng-model="username" autofocus></div><div class="sign-in__item"><label for="inputPassword" class="sr-only">Password</label><input type="text" id="inputPassword" class="form-control" placeholder="Password" ng-model="password" autocomplete="off"></div><button class="btn btn-lg btn-primary btn-block" type="submit">Sign in</button></form><button class="btn btn-lg btn-danger btn-block logout-btn" type="submit" ng-click="logout()">Logout</button></div>'),t.put("components/mail/mail.html",'<div class="mail"><h1 class="mail-title"><span ng-hide="isEdit">{{ mail.title }}</span> <input type="text" ng-show="isEdit" ng-model="mail.title" class="form-control"></h1><div class="mail-meta"><strong>Sender:</strong> {{ mail.sender }} | <strong>Date:</strong> <span class="mail-date">{{ mail.date }}</span></div><div class="mail-content" ng-hide="isEdit">{{ mail.content }}</div><div class="mail-edit" ng-show="isEdit"><textarea type="text" ng-model="mail.content"></textarea></div><div class="mail-controls"><button class="btn btn-warning" ng-click="editMail()" ng-hide="isEdit"><span class="glyphicon glyphicon-pencil"></span> Edit</button> <button class="btn btn-primary" ng-click="saveMail()" ng-hide="!isEdit"><span class="glyphicon glyphicon-save"></span> Save</button><buttom class="btn btn-danger" ng-click="deleteMail()"><span class="glyphicon glyphicon-trash"></span> Delete</buttom></div></div>'),t.put("components/maillist/maillist.html",'<div class="inbox"><h1 class="page-header">{{ title }}</h1><div class="table-responsive"><table class="table table-striped"><thead><tr><th>Sender</th><th>Text</th><th>Date</th></tr></thead><tbody><tr ng-repeat="item in mails track by $index" ng-click="showFullMail(item)" class="inbox-item"><td>{{ item.sender }}</td><td>{{ item.title }}</td><td>{{ item.date }}</td></tr></tbody></table></div></div>'),t.put("components/menu/menu.html",'<ul class="nav nav-sidebar"><li ui-sref="inbox" ui-sref-active="active"><a><span class="glyphicon glyphicon-envelope"></span> Inbox</a></li><li ui-sref-active="active" ui-sref="drafts"><a><span class="glyphicon glyphicon-pencil"></span> Drafts</a></li><li ui-sref-active="active" ui-sref="sent"><a><span class="glyphicon glyphicon-ok"></span> Sent</a></li><li ui-sref="contacts" ui-sref-active="active"><a><span class="glyphicon glyphicon-list-alt"></span> Contacts</a></li></ul>'),t.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container-fluid"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/"><span class="glyphicon glyphicon-book"></span> Mailbox</a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a ui-sref="inbox">Mail</a></li><li><a ui-sref="contacts">Contacts</a></li><li><a ui-sref="help">FAQ</a></li></ul><search arr="users"></search></div></div></div>'),t.put("components/search/search.html",'<form class="navbar-form navbar-right"><div class="search-wrapper"><input type="text" class="form-control" placeholder="Search..." ng-model="searchString"><ul class="search-result"><li ng-repeat="item in arr | mailBoxSearch: searchString" ng-click="clearInput();"><a ui-sref="user({id: item.id})">{{ item.name }}</a></li></ul></div></form>'),t.put("pages/add-contact/add-contact.html",'<div ng-controller="AddContactPageController as vm"><div class="inbox"><h1 class="page-header">Add Contact</h1><form class="add-form"><input type="text" class="add-form-field form-control" placeholder="Name" ng-model="name"> <input type="tel" class="add-form-field form-control" placeholder="Company" ng-model="company"> <input type="email" class="add-form-field form-control" placeholder="E-mail" ng-model="email"> <input type="tel" class="add-form-field form-control" placeholder="Phone" ng-model="phone"> <input type="text" class="add-form-field form-control" placeholder="Website" ng-model="site"></form><div class="contact-controls"><button class="btn btn-primary" ng-click="vm.addContact(name, company, email, phone, site)"><span class="glyphicon glyphicon-save"></span> Save</button><buttom class="btn btn-danger" ng-click="vm.goBack()"><span class="glyphicon glyphicon-trash"></span> Cancel</buttom></div></div></div>'),t.put("pages/login/login.html",'<div class="login" ng-controller="LoginPageController as vm"><login user="vm.user"></login></div>'),t.put("pages/mail-page/mail-page.html",'<div ng-controller="MailPageController as vm"><mail-list></mail-list></div>')}]);